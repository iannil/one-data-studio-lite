# 待解决问题清单

> 最后更新: 2026-02-16

## 测试失败 (11个)

### 优先级: 高

#### API 测试失败 (9个)

| 测试文件 | 测试用例 | 问题描述 | 建议修复 |
|---------|---------|---------|---------|
| test_api.py | 多个端点 | HTTP 状态码预期值与实际不符 | 调整测试预期值或统一 API 响应码 |

**根因分析**: API 端点返回的状态码与测试用例中的预期值不一致，需要统一 API 设计规范。

**修复建议**:
1. 审查 `api/v1/*.py` 中的状态码返回
2. 统一错误处理和响应格式
3. 更新测试用例预期值

---

### 优先级: 中

#### Excel 连接器测试失败 (1个)

| 测试文件 | 测试用例 | 问题描述 |
|---------|---------|---------|
| test_connectors.py | Excel 相关 | 断言失败 |

**修复建议**: 检查 `connectors/file.py` 中 Excel 处理逻辑

---

#### ETL 类型转换测试失败 (1个)

| 测试文件 | 测试用例 | 问题描述 |
|---------|---------|---------|
| test_etl_steps.py | 类型转换 | 边界条件处理不足 |

**修复建议**: 增强 `services/etl_engine.py` 中类型转换的边界处理

---

## 依赖问题

### 已修复

| 问题 | 解决方案 | 状态 |
|-----|---------|------|
| bcrypt 5.x 与 passlib 不兼容 | 降级至 bcrypt 4.3.0 | ✅ 已修复 |
| Python 3.9 类型注解 | 添加 `from __future__ import annotations` | ✅ 已修复 |
| Pydantic 类型检查 | 安装 eval_type_backport | ✅ 已修复 |

### 待修复

| 问题 | 文件 | 建议修复 |
|-----|------|---------|
| httpx 重复定义 | requirements.txt:47,54 | 删除重复行 |
| bcrypt 版本约束缺失 | requirements.txt | 添加 `bcrypt<5.0.0` |
| eval_type_backport 缺失 | requirements.txt | 添加依赖 |

---

## 代码质量问题

### 待检查

| 类型 | 检查内容 | 工具 |
|-----|---------|------|
| 未使用导入 | 清理冗余 import | pylint, ruff |
| 未使用变量 | 清理冗余定义 | pylint, ruff |
| 类型注解 | 补充缺失类型 | mypy |

### 目录清理

| 目录 | 状态 | 操作 |
|-----|------|------|
| `docs/progress/` | 空目录 | 保留，用于进行中文档 |
| `__pycache__/` | 多处存在 | 添加到 .gitignore |

---

## 功能缺失

### AI 分析模块 (完成度 30%)

| 功能 | 状态 | 优先级 |
|-----|------|-------|
| 字段智能分析 | ⚠️ 部分实现 | 高 |
| Text-to-SQL | ⚠️ 部分实现 | 中 |
| 清洗规则建议 | ⚠️ 部分实现 | 中 |
| 异常检测 | ❌ 未实现 | 低 |

---

## 修复优先级

1. **P0 - 立即修复**
   - 修复 requirements.txt 依赖问题

2. **P1 - 本周修复**
   - 修复 API 测试状态码问题
   - 修复 Excel 连接器断言

3. **P2 - 下周修复**
   - 修复 ETL 类型转换边界
   - 完善 AI 分析功能

4. **P3 - 待定**
   - 代码质量清理
   - 提升测试覆盖率
